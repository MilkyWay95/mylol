<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>LoL Iron to Silver Player</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 1200px; margin: 0 auto; padding: 20px; background-color: #f5f5f5; }
        .player-container { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        select, input { padding: 10px; margin: 5px 0; width: 100%; max-width: 500px; border: 1px solid #ddd; border-radius: 4px; }
        button { padding: 10px 15px; margin: 5px 5px 5px 0; background: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #45a049; }
        #video { width: 100%; max-width: 800px; height: 450px; background: #000; margin-top: 20px; }
        .controls { margin: 15px 0; }
        #status { color: #666; font-style: italic; margin-top: 10px; }
        #downloadBtn { background: #2196F3; }
        #downloadBtn:hover { background: #0b7dda; }
        .progress-container { width: 100%; background-color: #ddd; margin-top: 10px; border-radius: 4px; display: none; }
        #downloadProgress { width: 0; height: 20px; background-color: #4CAF50; border-radius: 4px; text-align: center; line-height: 20px; color: white; }
        .error { color: red; }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
</head>
<body>
    <div class="player-container">
        <h1>LoL Iron to Silver Guide</h1>
        <div>
            <label for="url">Select Video:</label>
            <select id="url" style="width: 100%;">
                <option value="">Choose a lesson</option>
                <option value="7c05gxjdt7">1. Bronze to Diamond Course Introduction (1:39)</option>
                <option value="8krm8cc13t">2. Bronze to Diamond Episode 1 (14:14)</option>
                <option value="r5j0v9dj38">3. Introduction ADC Basics (63:13)</option>
                <option value="rfvkqf8g1z">4. Basic Mechanics (61:46)</option>
                <option value="4wzrjcf6nn">5. Map Awareness (34:51)</option>
                <option value="80kt8ps0k3">6. Objective Control Basics (75:18)</option>
                <option value="8tfwzdsvk6">7. Simple Wave Management (60:21)</option>
                <option value="qj8l3hld93">8. Climbing Fundamentals (44:03)</option>
            </select>
        </div>
        <div class="controls">
            <button onclick="playVideo()">Play</button>
            <button onclick="stopVideo()">Stop</button>
            <button id="downloadBtn" onclick="downloadVideo()" disabled>Download</button>
        </div>
        <div id="status">Select a video to play</div>
        <video id="video" controls></video>
    </div>

    <script>
        const videoElement = document.getElementById('video');
        const statusElement = document.getElementById('status');
        const downloadBtn = document.getElementById('downloadBtn');
        let hls;

        async function playVideo() {
            const videoId = document.getElementById('url').value;
            if (!videoId) {
                alert('Please select a video first!');
                return;
            }

            statusElement.textContent = 'Loading...';
            downloadBtn.disabled = true;

            // Останавливаем предыдущее видео
            if (hls) {
                hls.destroy();
            }

            // Пробуем два варианта URL сегментов
            const baseUrls = [
                `https://d13z5uuzt1wkbz.cloudfront.net/${videoId}/`,
                `https://d15x55s5df2f5v.cloudfront.net/${videoId}/`
            ];

            let foundSegments = false;

            for (const baseUrl of baseUrls) {
                const testSegment = `${baseUrl}HIDDEN4500-00001.ts`;
                try {
                    const response = await fetch(testSegment, { method: 'HEAD' });
                    if (response.ok) {
                        await initHLS(baseUrl, videoId);
                        foundSegments = true;
                        break;
                    }
                } catch (e) {
                    console.log(`Failed to access ${baseUrl}`);
                }
            }

            if (!foundSegments) {
                statusElement.textContent = 'Error: Cannot access video segments';
                statusElement.className = 'error';
            }
        }

        async function initHLS(baseUrl, videoId) {
            const manifestUrl = `${baseUrl}playlist.m3u8`;
            
            if (Hls.isSupported()) {
                hls = new Hls({
                    maxBufferLength: 600,
                    maxBufferSize: 60*1000*1000,
                    maxMaxBufferLength: 600
                });
                
                try {
                    // Пробуем загрузить стандартный HLS плейлист
                    hls.loadSource(manifestUrl);
                    hls.attachMedia(videoElement);
                    
                    hls.on(Hls.Events.MANIFEST_PARSED, () => {
                        videoElement.play();
                        statusElement.textContent = 'Playing';
                        downloadBtn.disabled = false;
                    });
                    
                    hls.on(Hls.Events.ERROR, (event, data) => {
                        if (data.fatal) {
                            fallbackToManualSegments(baseUrl, videoId);
                        }
                    });
                    
                } catch (e) {
                    fallbackToManualSegments(baseUrl, videoId);
                }
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                // Для Safari
                videoElement.src = manifestUrl;
                videoElement.addEventListener('loadedmetadata', () => {
                    videoElement.play();
                    statusElement.textContent = 'Playing';
                    downloadBtn.disabled = false;
                });
            } else {
                statusElement.textContent = 'Error: HLS not supported';
                statusElement.className = 'error';
            }
        }

        function stopVideo() {
            if (hls) hls.destroy();
            if (videoElement) {
                videoElement.pause();
                videoElement.src = '';
            }
            statusElement.textContent = 'Stopped';
        }

        function downloadVideo() {
            alert('Download functionality needs server-side implementation!');
        }

        // Fallback: если стандартный HLS не работает
        async function fallbackToManualSegments(baseUrl, videoId) {
            statusElement.textContent = 'Trying alternative method...';
            
            try {
                // Здесь можно реализовать альтернативный метод
                // Например, через создание виртуального плейлиста
                statusElement.textContent = 'Error: Failed to load video';
                statusElement.className = 'error';
            } catch (e) {
                statusElement.textContent = 'Error: ' + e.message;
                statusElement.className = 'error';
            }
        }
    </script>
</body>
</html>